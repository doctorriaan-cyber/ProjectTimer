<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Project Timer</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&family=Roboto+Mono:wght@400;500&display=swap" rel="stylesheet">
  
  <style>
    /* Basic Reset & Setup */
    *, *::before, *::after {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    :root {
      --font-sans: 'Inter', sans-serif;
      --font-mono: 'Roboto Mono', monospace;

      --teal-400: #2dd4bf;
      --teal-500: #14b8a6;
      --teal-600: #0d9488;
      --red-500: #ef4444;
      --red-600: #dc2626;

      /* Light Theme */
      --bg-primary-light: #f8fafc;
      --bg-secondary-light: #ffffff;
      --text-primary-light: #0f172a;
      --text-secondary-light: #64748b;
      --border-light: #e2e8f0;

      /* Dark Theme */
      --bg-primary-dark: #0f172a;
      --bg-secondary-dark: #1e293b;
      --text-primary-dark: #f8fafc;
      --text-secondary-dark: #94a3b8;
      --border-dark: #334155;
    }

    body {
      font-family: var(--font-sans);
      transition: background-color 0.3s ease, color 0.3s ease;
    }

    body.light {
      background-color: var(--bg-primary-light);
      color: var(--text-primary-light);
    }

    body.dark {
      background-color: var(--bg-primary-dark);
      color: var(--text-primary-dark);
    }

    #root {
      max-width: 500px;
      margin: 0 auto;
      padding: 1rem;
      padding-bottom: 6rem; /* Space for FAB */
      display: flex;
      flex-direction: column;
      min-height: 100vh;
    }

    /* Header */
    .header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 0.5rem 0;
      margin-bottom: 1.5rem;
    }

    .icon-button {
      background: none;
      border: none;
      cursor: pointer;
      padding: 0.5rem;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: background-color 0.2s ease;
    }
    .icon-button:hover {
      background-color: rgba(0, 0, 0, 0.05);
    }
    body.dark .icon-button:hover {
      background-color: rgba(255, 255, 255, 0.1);
    }
    .icon-button svg {
      width: 24px;
      height: 24px;
    }
    body.light .icon-button svg { fill: var(--text-primary-light); }
    body.dark .icon-button svg { fill: var(--text-primary-dark); }

    .save-button {
      background-color: var(--teal-500);
      color: white;
      border: none;
      padding: 0.6rem 1.2rem;
      border-radius: 8px;
      font-weight: 500;
      cursor: pointer;
      transition: background-color 0.2s ease;
    }
    .save-button:hover {
      background-color: var(--teal-600);
    }
    .save-button.saved {
      background-color: var(--teal-600);
    }


    /* Project List */
    .project-list {
      list-style: none;
      display: flex;
      flex-direction: column;
      gap: 1rem;
    }
    .no-projects {
        text-align: center;
        margin-top: 4rem;
    }
    body.light .no-projects { color: var(--text-secondary-light); }
    body.dark .no-projects { color: var(--text-secondary-dark); }


    .project-item {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      padding: 1rem;
      border-radius: 12px;
      transition: background-color 0.3s ease;
    }
    body.light .project-item {
      background-color: var(--bg-secondary-light);
      border: 1px solid var(--border-light);
    }
    body.dark .project-item {
      background-color: var(--bg-secondary-dark);
      border: 1px solid var(--border-dark);
    }

    .project-details {
      flex-grow: 1;
      margin: 0 0.5rem;
    }

    .project-name {
      font-weight: 500;
      font-size: 1.1rem;
      margin-bottom: 0.25rem;
    }
    body.light .project-name { color: var(--text-primary-light); }
    body.dark .project-name { color: var(--text-primary-dark); }

    .project-notes {
      font-size: 0.9rem;
      margin-bottom: 0.5rem;
      font-style: italic;
      opacity: 0.9;
    }
    body.light .project-notes { color: var(--text-secondary-light); }
    body.dark .project-notes { color: var(--text-secondary-dark); }


    .project-time {
      font-family: var(--font-mono);
      font-size: 1.25rem;
      font-weight: 500;
    }
    body.light .project-time { color: var(--teal-600); }
    body.dark .project-time { color: var(--teal-400); }


    .project-actions {
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    body.light .delete-button svg { 
      fill: var(--text-secondary-light); 
      transition: fill 0.2s ease;
    }
    .delete-button:hover svg { fill: var(--red-500); }
    body.dark .delete-button svg { 
      fill: var(--text-secondary-dark);
      transition: fill 0.2s ease;
    }
    body.dark .delete-button:hover svg { fill: var(--red-500); }


    .play-pause-button {
      background-color: var(--teal-500);
      border: none;
      border-radius: 50%;
      width: 48px;
      height: 48px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: background-color 0.2s ease;
    }
    .play-pause-button:hover {
      background-color: var(--teal-600);
    }
    .play-pause-button svg {
      fill: white;
      width: 24px;
      height: 24px;
    }
    .play-pause-button.running {
      background-color: var(--red-500);
    }
    .play-pause-button.running:hover {
      background-color: var(--red-600);
    }

    /* Add Project Button (FAB) */
    .add-project-fab {
      position: fixed;
      bottom: 2rem;
      left: 50%;
      transform: translateX(-50%);
      width: 60px;
      height: 60px;
      background-color: var(--teal-500);
      border-radius: 50%;
      border: none;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
      cursor: pointer;
      transition: background-color 0.2s ease, transform 0.2s ease;
    }
    .add-project-fab:hover {
      background-color: var(--teal-600);
      transform: translateX(-50%) scale(1.05);
    }
    .add-project-fab svg {
      fill: white;
      width: 32px;
      height: 32px;
    }

    /* Modal */
    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: rgba(0, 0, 0, 0.5);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1000;
    }
    .modal-content {
      padding: 1.5rem;
      border-radius: 12px;
      width: 90%;
      max-width: 400px;
    }
    body.light .modal-content {
      background-color: var(--bg-secondary-light);
    }
    body.dark .modal-content {
      background-color: var(--bg-secondary-dark);
    }

    .modal-content h2 {
      margin-bottom: 1.5rem;
      text-align: center;
    }

    .confirm-message {
      margin-bottom: 1.5rem;
      text-align: center;
      line-height: 1.5;
    }
    body.light .confirm-message { color: var(--text-secondary-light); }
    body.dark .confirm-message { color: var(--text-secondary-dark); }

    .form-group {
      margin-bottom: 1rem;
    }
    .form-group label {
      display: block;
      margin-bottom: 0.5rem;
      font-weight: 500;
      font-size: 0.9rem;
    }
    body.light .form-group label { color: var(--text-secondary-light); }
    body.dark .form-group label { color: var(--text-secondary-dark); }


    .form-input, .form-textarea {
      width: 100%;
      padding: 0.75rem;
      border-radius: 8px;
      border: 1px solid;
      font-size: 1rem;
      font-family: var(--font-sans);
      transition: border-color 0.2s ease, box-shadow 0.2s ease;
    }
    body.light .form-input, body.light .form-textarea {
      background-color: var(--bg-primary-light);
      border-color: var(--border-light);
      color: var(--text-primary-light);
    }
    body.dark .form-input, body.dark .form-textarea {
      background-color: var(--bg-primary-dark);
      border-color: var(--border-dark);
      color: var(--text-primary-dark);
    }
    .form-input:focus, .form-textarea:focus {
      outline: none;
      border-color: var(--teal-500);
      box-shadow: 0 0 0 3px rgba(20, 184, 166, 0.2);
    }

    .form-textarea {
      resize: vertical;
      min-height: 80px;
    }

    .modal-actions {
      display: flex;
      justify-content: flex-end;
      gap: 0.5rem;
      margin-top: 1.5rem;
    }

    .modal-button {
      border: none;
      padding: 0.6rem 1.2rem;
      border-radius: 8px;
      font-weight: 500;
      cursor: pointer;
      transition: background-color 0.2s ease, color 0.2s ease;
    }
    .modal-button.primary {
      background-color: var(--teal-500);
      color: white;
    }
    .modal-button.primary:hover {
      background-color: var(--teal-600);
    }
    .modal-button.danger {
      background-color: var(--red-500);
      color: white;
    }
    .modal-button.danger:hover {
      background-color: var(--red-600);
    }
    .modal-button.secondary {
      background-color: transparent;
    }
    body.light .modal-button.secondary {
      color: var(--text-secondary-light);
    }
    body.dark .modal-button.secondary {
      color: var(--text-secondary-dark);
    }

    body.light .modal-button.secondary:hover {
      background-color: rgba(0, 0, 0, 0.05);
    }
    body.dark .modal-button.secondary:hover {
      background-color: rgba(255, 255, 255, 0.1);
    }
  </style>
  
  <script type="importmap">
  {
    "imports": {
      "react": "https://esm.sh/react@18.3.1",
      "react-dom/client": "https://esm.sh/react-dom@18.3.1/client"
    }
  }
  </script>
  <!-- Babel for in-browser JSX transpilation -->
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel" data-type="module">
    import React, { useState, useEffect, useCallback } from 'react';
    import { createRoot } from 'react-dom/client';

    // --- TYPE DEFINITIONS ---
    // Note: In a standalone Babel setup, interfaces might need to be declared as types
    // but modern Babel versions handle it well.
    type Theme = 'light' | 'dark';

    interface Project {
      id: number;
      name: string;
      notes: string;
      timeSpent: number; // in seconds
      isRunning: boolean;
    }

    // --- CONSTANTS ---
    const LOCAL_STORAGE_KEYS = {
      PROJECTS: 'project-timer-projects',
      THEME: 'project-timer-theme',
    };

    // --- HELPER FUNCTIONS ---
    const formatTime = (totalSeconds) => {
      const hours = Math.floor(totalSeconds / 3600);
      const minutes = Math.floor((totalSeconds % 3600) / 60);
      const seconds = totalSeconds % 60;
      return [hours, minutes, seconds]
        .map(val => val.toString().padStart(2, '0'))
        .join(':');
    };

    // --- SVG ICONS ---
    const SunIcon = () => (
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 7c-2.76 0-5 2.24-5 5s2.24 5 5 5 5-2.24 5-5-2.24-5-5-5zM2 13h2c.55 0 1-.45 1-1s-.45-1-1-1H2c-.55 0-1 .45-1 1s.45 1 1 1zm18 0h2c.55 0 1-.45 1-1s-.45-1-1-1h-2c-.55 0-1 .45-1 1s.45 1 1 1zM11 2v2c0 .55.45 1 1 1s1-.45 1-1V2c0-.55-.45-1-1-1s-1 .45-1 1zm0 18v2c0 .55.45 1 1 1s1-.45 1-1v-2c0-.55-.45-1-1-1s-1 .45-1 1zM5.64 5.64c.39.39 1.02.39 1.41 0 .39-.39.39-1.02 0-1.41L5.64 2.81c-.39-.39-1.02-.39-1.41 0-.39.39-.39 1.02 0 1.41l1.41 1.42zm12.72 12.72c.39.39 1.02.39 1.41 0 .39-.39.39-1.02 0-1.41l-1.41-1.42c-.39-.39-1.02-.39-1.41 0-.39.39-.39 1.02 0 1.41l1.41 1.42zM5.64 18.36c-.39.39-.39 1.02 0 1.41.39.39 1.02.39 1.41 0l1.41-1.41c.39-.39.39-1.02 0-1.41-.39-.39-1.02-.39-1.41 0l-1.41 1.41zM18.36 5.64c-.39.39-.39 1.02 0 1.41.39.39 1.02.39 1.41 0l1.41-1.41c.39-.39.39-1.02 0-1.41-.39-.39-1.02-.39-1.41 0l-1.41 1.41z"/></svg>
    );
    const MoonIcon = () => (
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 3c-4.97 0-9 4.03-9 9s4.03 9 9 9c.83 0 1.64-.11 2.41-.31-1.1-1.04-1.74-2.45-1.74-4.02 0-3.19 2.45-5.04 5.33-5.04.92 0 1.55.23 2.15.54C19.01 5.92 15.79 3 12 3z"/></svg>
    );
    const PlusIcon = () => (
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/></svg>
    );
    const PlayIcon = () => (
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></svg>
    );
    const PauseIcon = () => (
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M6 19h4V5H6v14zm8-14v14h4V5h-4z"/></svg>
    );
    const TrashIcon = () => (
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z"/></svg>
    );

    // --- COMPONENTS ---

    const ConfirmationModal = ({ message, onConfirm, onCancel }) => {
        return (
            <div className="modal-overlay" onClick={onCancel}>
                <div className="modal-content" onClick={(e) => e.stopPropagation()}>
                    <h2>Confirm Action</h2>
                    <p className="confirm-message">{message}</p>
                    <div className="modal-actions">
                        <button type="button" className="modal-button secondary" onClick={onCancel}>Cancel</button>
                        <button type="button" className="modal-button danger" onClick={onConfirm}>Delete</button>
                    </div>
                </div>
            </div>
        );
    };

    const AddProjectModal = ({ onAdd, onClose }) => {
        const [name, setName] = useState('');
        const [time, setTime] = useState('0');
        const [notes, setNotes] = useState('');

        const handleSubmit = (e) => {
            e.preventDefault();
            if (name.trim()) {
                onAdd(name.trim(), parseInt(time, 10) || 0, notes.trim());
                onClose();
            }
        };

        return (
            <div className="modal-overlay" onClick={onClose}>
                <div className="modal-content" onClick={(e) => e.stopPropagation()}>
                    <h2>Add New Project</h2>
                    <form onSubmit={handleSubmit}>
                        <div className="form-group">
                            <label htmlFor="projectName">Project Name</label>
                            <input id="projectName" type="text" value={name} onChange={(e) => setName(e.target.value)} className="form-input" required autoFocus/>
                        </div>
                        <div className="form-group">
                            <label htmlFor="projectTime">Time Already Spent (minutes)</label>
                            <input id="projectTime" type="number" value={time} onChange={(e) => setTime(e.target.value)} className="form-input" min="0"/>
                        </div>
                        <div className="form-group">
                            <label htmlFor="projectNotes">Notes</label>
                            <textarea id="projectNotes" value={notes} onChange={(e) => setNotes(e.target.value)} className="form-textarea"/>
                        </div>
                        <div className="modal-actions">
                            <button type="button" className="modal-button secondary" onClick={onClose}>Cancel</button>
                            <button type="submit" className="modal-button primary">Add Project</button>
                        </div>
                    </form>
                </div>
            </div>
        );
    };

    const ProjectItem = ({ project, onToggle, onDelete }) => {
        return (
            <li className="project-item">
                <button className="icon-button delete-button" onClick={() => onDelete(project.id)} aria-label="Delete project">
                    <TrashIcon />
                </button>
                <div className="project-details">
                    <div className="project-name">{project.name}</div>
                    {project.notes && <div className="project-notes">{project.notes}</div>}
                    <div className="project-time">{formatTime(project.timeSpent)}</div>
                </div>
                <div className="project-actions">
                    <button className={`play-pause-button ${project.isRunning ? 'running' : ''}`} onClick={() => onToggle(project.id)} aria-label={project.isRunning ? 'Pause timer' : 'Start timer'}>
                        {project.isRunning ? <PauseIcon /> : <PlayIcon />}
                    </button>
                </div>
            </li>
        );
    };

    const App = () => {
        const [projects, setProjects] = useState([]);
        const [theme, setTheme] = useState('light');
        const [isAddModalOpen, setIsAddModalOpen] = useState(false);
        const [isConfirmModalOpen, setIsConfirmModalOpen] = useState(false);
        const [projectToDelete, setProjectToDelete] = useState(null);
        const [saveState, setSaveState] = useState('idle');

        // Load from localStorage on initial render
        useEffect(() => {
            try {
                const savedProjects = localStorage.getItem(LOCAL_STORAGE_KEYS.PROJECTS);
                const savedTheme = localStorage.getItem(LOCAL_STORAGE_KEYS.THEME);

                if (savedProjects) {
                    setProjects(JSON.parse(savedProjects));
                }
                if (savedTheme && (savedTheme === 'light' || savedTheme === 'dark')) {
                    setTheme(savedTheme);
                }
            } catch (error) {
                console.error("Failed to load from localStorage", error);
            }
        }, []);
        
        // Apply theme to body
        useEffect(() => {
            document.body.className = theme;
        }, [theme]);
        
        // Main timer interval
        useEffect(() => {
            const interval = setInterval(() => {
                setProjects(prevProjects =>
                    prevProjects.map(p =>
                        p.isRunning ? { ...p, timeSpent: p.timeSpent + 1 } : p
                    )
                );
            }, 1000);
            return () => clearInterval(interval);
        }, []);

        const handleSave = useCallback(() => {
            try {
                // Pause all running timers before saving
                const projectsToSave = projects.map(p => ({ ...p, isRunning: false }));
                localStorage.setItem(LOCAL_STORAGE_KEYS.PROJECTS, JSON.stringify(projectsToSave));
                localStorage.setItem(LOCAL_STORAGE_KEYS.THEME, theme);
                setProjects(projectsToSave); // Update state to reflect paused timers
                setSaveState('saved');
                setTimeout(() => setSaveState('idle'), 1500);
            } catch (error) {
                console.error("Failed to save to localStorage", error);
                alert("Could not save data. Your browser's storage might be full.");
            }
        }, [projects, theme]);
        
        const toggleTheme = () => {
            setTheme(current => current === 'light' ? 'dark' : 'light');
        };

        const addProject = (name, timeInMinutes, notes) => {
            const newProject = {
                id: Date.now(),
                name,
                notes,
                timeSpent: timeInMinutes * 60,
                isRunning: false,
            };
            setProjects(prev => [...prev, newProject]);
        };
        
        const handleDeleteRequest = (id) => {
            setProjectToDelete(id);
            setIsConfirmModalOpen(true);
        };

        const handleConfirmDelete = () => {
            if (projectToDelete !== null) {
                setProjects(prev => prev.filter(p => p.id !== projectToDelete));
            }
            setProjectToDelete(null);
            setIsConfirmModalOpen(false);
        };

        const handleCancelDelete = () => {
            setProjectToDelete(null);
            setIsConfirmModalOpen(false);
        };
        
        const toggleTimer = (id) => {
            setProjects(prev => prev.map(p =>
                p.id === id ? { ...p, isRunning: !p.isRunning } : p
            ));
        };
        
        const projectToDeleteDetails = projects.find(p => p.id === projectToDelete);

        return (
            <>
                <header className="header">
                    <button className="icon-button" onClick={toggleTheme} aria-label="Toggle theme">
                        {theme === 'light' ? <MoonIcon /> : <SunIcon />}
                    </button>
                    <button className={`save-button ${saveState}`} onClick={handleSave}>
                        {saveState === 'saved' ? 'Saved!' : 'Save'}
                    </button>
                </header>

                <main>
                    {projects.length > 0 ? (
                        <ul className="project-list">
                            {projects.map(project => (
                                <ProjectItem
                                    key={project.id}
                                    project={project}
                                    onToggle={toggleTimer}
                                    onDelete={handleDeleteRequest}
                                />
                            ))}
                        </ul>
                    ) : (
                        <div className="no-projects">
                            <p>No projects yet.</p>
                            <p>Click the '+' button to add one.</p>
                        </div>
                    )}
                </main>

                <button className="add-project-fab" onClick={() => setIsAddModalOpen(true)} aria-label="Add new project">
                    <PlusIcon />
                </button>
                
                {isAddModalOpen && <AddProjectModal onAdd={addProject} onClose={() => setIsAddModalOpen(false)} />}
                
                {isConfirmModalOpen && projectToDeleteDetails && (
                    <ConfirmationModal 
                        message={`Are you sure you want to delete "${projectToDeleteDetails.name}"? This action cannot be undone.`}
                        onConfirm={handleConfirmDelete}
                        onCancel={handleCancelDelete}
                    />
                )}
            </>
        );
    };

    const container = document.getElementById('root');
    if(container) {
        const root = createRoot(container);
        root.render(<App />);
    }
  </script>
</body>
</html>
